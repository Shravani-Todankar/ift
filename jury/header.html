<!-- Top Navigation Header -->
<header class="top-header">
    <!-- Sidebar Toggle Button -->
    <button class="header-icon-btn" id="sidebarToggleBtn" style="margin-right: 16px;">
        <span class="material-symbols-outlined">menu</span>
    </button>

    <!-- Header Right Side -->
    <div class="d-flex align-items-center gap-2 ms-auto">
        <button class="header-icon-btn" id="notificationBtn">
            <span class="material-symbols-outlined">notifications</span>
        </button>
        <button class="header-icon-btn" id="helpBtn">
            <span class="material-symbols-outlined">help</span>
        </button>
        <div class="header-avatar" id="profileAvatarBtn" style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuCuvM4h22-G2QJVfQTcNUIEkq41Xunl8wpGK2jUUAu1aPfGpxMyu9nIHKPfFL9ubW7jB_SNhu36Y0R_JZKln8oxW-kLtMx7bFkPpcDJGj8S3-cEZUar5_XyCsUeXbxGAMApRQNx5Pmch6G_kpZ1Iovfm-lhUFqL5YE8DTyTXppH1Bvgj1IElUzBt3-UBgCcTe9x5mK4ipf8KjfSK8vzW4H_awp6bjKWG7ziak6vUxK4E3_0jOND2-QqTIxDY1vLP1u2pBUPtryYKwM");'></div>
    </div>
</header>

<!-- Notification Panel (Initially Hidden) -->
<div id="notificationPanel" style="position: fixed; top: 70px; right: 20px; width: 360px; max-height: 500px; background: white; border-radius: 12px; box-shadow: 0 10px 40px rgba(0,0,0,0.15); z-index: 9999; overflow: hidden; display: none; opacity: 0; transform: translateY(-10px); transition: opacity 0.3s ease, transform 0.3s ease;">
    <div style="padding: 16px; border-bottom: 1px solid #f1f5f9; display: flex; justify-content: space-between; align-items: center;">
        <h3 style="margin: 0; font-size: 1rem; font-weight: 700; color: #0f172a;">Notifications</h3>
        <button id="closeNotificationPanel" style="background: none; border: none; cursor: pointer; color: #94a3b8;">
            <span class="material-symbols-outlined" style="font-size: 20px;">close</span>
        </button>
    </div>
    <div style="max-height: 400px; overflow-y: auto; padding: 8px;">
        <div class="notification-item" style="padding: 12px; border-radius: 8px; cursor: pointer; transition: background 0.2s;" onmouseover="this.style.backgroundColor='#f8fafc'" onmouseout="this.style.backgroundColor='transparent'">
            <div style="display: flex; gap: 12px;">
                <div style="width: 32px; height: 32px; border-radius: 50%; background: #e8d4f0; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                    <span class="material-symbols-outlined" style="font-size: 16px; color: #5E2A97;">lightbulb</span>
                </div>
                <div style="flex: 1;">
                    <p style="margin: 0; font-size: 0.875rem; font-weight: 600; color: #1e293b;">New Idea Assigned</p>
                    <p style="margin: 4px 0 0 0; font-size: 0.75rem; color: #64748b;">You have a new idea to evaluate</p>
                    <p style="margin: 4px 0 0 0; font-size: 0.625rem; color: #94a3b8;">2 hours ago</p>
                </div>
            </div>
        </div>
        <div class="notification-item" style="padding: 12px; border-radius: 8px; cursor: pointer; background: rgba(94, 42, 151, 0.05); border-left: 2px solid #5E2A97;" onmouseover="this.style.backgroundColor='rgba(94, 42, 151, 0.08)'" onmouseout="this.style.backgroundColor='rgba(94, 42, 151, 0.05)'">
            <div style="display: flex; gap: 12px;">
                <div style="width: 32px; height: 32px; border-radius: 50%; background: rgba(94, 42, 151, 0.2); display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                    <span class="material-symbols-outlined" style="font-size: 16px; color: #5E2A97;">priority_high</span>
                </div>
                <div style="flex: 1;">
                    <p style="margin: 0; font-size: 0.875rem; font-weight: 600; color: #1e293b;">Deadline Approaching</p>
                    <p style="margin: 4px 0 0 0; font-size: 0.75rem; color: #64748b;">3 evaluations due tomorrow</p>
                    <p style="margin: 4px 0 0 0; font-size: 0.625rem; color: #94a3b8;">5 hours ago</p>
                </div>
            </div>
        </div>
        <div class="notification-item" style="padding: 12px; border-radius: 8px; cursor: pointer; transition: background 0.2s;" onmouseover="this.style.backgroundColor='#f8fafc'" onmouseout="this.style.backgroundColor='transparent'">
            <div style="display: flex; gap: 12px;">
                <div style="width: 32px; height: 32px; border-radius: 50%; background: #dcfce7; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                    <span class="material-symbols-outlined" style="font-size: 16px; color: #16a34a;">check_circle</span>
                </div>
                <div style="flex: 1;">
                    <p style="margin: 0; font-size: 0.875rem; font-weight: 600; color: #1e293b;">Evaluation Submitted</p>
                    <p style="margin: 4px 0 0 0; font-size: 0.75rem; color: #64748b;">Your evaluation was submitted successfully</p>
                    <p style="margin: 4px 0 0 0; font-size: 0.625rem; color: #94a3b8;">1 day ago</p>
                </div>
            </div>
        </div>
    </div>
    <div style="padding: 12px; border-top: 1px solid #f1f5f9; text-align: center;">
        <button style="width: 100%; padding: 8px; background: none; border: none; color: #5E2A97; font-weight: 500; cursor: pointer; font-size: 0.875rem;" onmouseover="this.style.textDecoration='underline'" onmouseout="this.style.textDecoration='none'">View All Notifications</button>
    </div>
</div>

<!-- Help Modal (Initially Hidden) -->
<div id="helpModal" style="position: fixed; top: 70px; right: 20px; width: 320px; background: white; border-radius: 12px; box-shadow: 0 10px 40px rgba(0,0,0,0.15); z-index: 9999; overflow: hidden; display: none; opacity: 0; transform: translateY(-10px); transition: opacity 0.3s ease, transform 0.3s ease;">
    <div style="padding: 16px; border-bottom: 1px solid #f1f5f9; display: flex; justify-content: space-between; align-items: center;">
        <h3 style="margin: 0; font-size: 1rem; font-weight: 700; color: #0f172a;">Help & Support</h3>
        <button id="closeHelpModal" style="background: none; border: none; cursor: pointer; color: #94a3b8;">
            <span class="material-symbols-outlined" style="font-size: 20px;">close</span>
        </button>
    </div>
    <div style="padding: 16px;">
        <a href="#faq" style="display: flex; align-items: center; gap: 12px; padding: 12px; border-radius: 8px; text-decoration: none; color: #0f172a; transition: background 0.2s;" onmouseover="this.style.backgroundColor='#f8fafc'" onmouseout="this.style.backgroundColor='transparent'">
            <span class="material-symbols-outlined" style="color: #5E2A97;">help_center</span>
            <span style="font-weight: 500; font-size: 0.875rem;">FAQ</span>
        </a>
        <a href="#contact" style="display: flex; align-items: center; gap: 12px; padding: 12px; border-radius: 8px; text-decoration: none; color: #0f172a; transition: background 0.2s;" onmouseover="this.style.backgroundColor='#f8fafc'" onmouseout="this.style.backgroundColor='transparent'">
            <span class="material-symbols-outlined" style="color: #5E2A97;">support_agent</span>
            <span style="font-weight: 500; font-size: 0.875rem;">Contact Support</span>
        </a>
        <a href="#feedback" style="display: flex; align-items: center; gap: 12px; padding: 12px; border-radius: 8px; text-decoration: none; color: #0f172a; transition: background 0.2s;" onmouseover="this.style.backgroundColor='#f8fafc'" onmouseout="this.style.backgroundColor='transparent'">
            <span class="material-symbols-outlined" style="color: #5E2A97;">feedback</span>
            <span style="font-weight: 500; font-size: 0.875rem;">Send Feedback</span>
        </a>
    </div>
</div>

<!-- Profile Dropdown (Initially Hidden) -->
<div id="profileDropdown" style="position: fixed; top: 70px; right: 20px; width: 280px; background: white; border-radius: 12px; box-shadow: 0 10px 40px rgba(0,0,0,0.15); z-index: 9999; overflow: hidden; display: none; opacity: 0; transform: translateY(-10px); transition: opacity 0.3s ease, transform 0.3s ease;">
    <!-- User Info Section -->
    <div style="padding: 16px; border-bottom: 1px solid #f1f5f9;">
        <div style="display: flex; align-items: center; gap: 12px;">
            <div style="width: 48px; height: 48px; border-radius: 50%; background-image: url('https://lh3.googleusercontent.com/aida-public/AB6AXuCuvM4h22-G2QJVfQTcNUIEkq41Xunl8wpGK2jUUAu1aPfGpxMyu9nIHKPfFL9ubW7jB_SNhu36Y0R_JZKln8oxW-kLtMx7bFkPpcDJGj8S3-cEZUar5_XyCsUeXbxGAMApRQNx5Pmch6G_kpZ1Iovfm-lhUFqL5YE8DTyTXppH1Bvgj1IElUzBt3-UBgCcTe9x5mK4ipf8KjfSK8vzW4H_awp6bjKWG7ziak6vUxK4E3_0jOND2-QqTIxDY1vLP1u2pBUPtryYKwM'); background-size: cover; background-position: center; border: 2px solid #5E2A97;"></div>
            <div style="flex: 1; overflow: hidden;">
                <p style="margin: 0; font-size: 0.875rem; font-weight: 700; color: #0f172a; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">Dr. A. Sharma</p>
                <p style="margin: 4px 0 0 0; font-size: 0.75rem; color: #64748b; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">Senior Juror</p>
                <p style="margin: 2px 0 0 0; font-size: 0.625rem; color: #94a3b8; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">dr.sharma@jury.ift.org</p>
            </div>
        </div>
    </div>

    <!-- Menu Items -->
    <div style="padding: 8px;">
        <a href="#" style="display: flex; align-items: center; gap: 12px; padding: 12px; border-radius: 8px; text-decoration: none; color: #0f172a; transition: background 0.2s;" onmouseover="this.style.backgroundColor='#f8fafc'" onmouseout="this.style.backgroundColor='transparent'">
            <span class="material-symbols-outlined" style="color: #5E2A97; font-size: 20px;">person</span>
            <span style="font-weight: 500; font-size: 0.875rem;">My Profile</span>
        </a>
        <a href="#" style="display: flex; align-items: center; gap: 12px; padding: 12px; border-radius: 8px; text-decoration: none; color: #0f172a; transition: background 0.2s;" onmouseover="this.style.backgroundColor='#f8fafc'" onmouseout="this.style.backgroundColor='transparent'">
            <span class="material-symbols-outlined" style="color: #5E2A97; font-size: 20px;">assignment</span>
            <span style="font-weight: 500; font-size: 0.875rem;">My Evaluations</span>
        </a>
        <a href="#" style="display: flex; align-items: center; gap: 12px; padding: 12px; border-radius: 8px; text-decoration: none; color: #0f172a; transition: background 0.2s;" onmouseover="this.style.backgroundColor='#f8fafc'" onmouseout="this.style.backgroundColor='transparent'">
            <span class="material-symbols-outlined" style="color: #5E2A97; font-size: 20px;">history</span>
            <span style="font-weight: 500; font-size: 0.875rem;">Evaluation History</span>
        </a>
        <div style="height: 1px; background: #f1f5f9; margin: 8px 0;"></div>
        <a href="#" style="display: flex; align-items: center; gap: 12px; padding: 12px; border-radius: 8px; text-decoration: none; color: #0f172a; transition: background 0.2s;" onmouseover="this.style.backgroundColor='#f8fafc'" onmouseout="this.style.backgroundColor='transparent'">
            <span class="material-symbols-outlined" style="color: #64748b; font-size: 20px;">settings</span>
            <span style="font-weight: 500; font-size: 0.875rem;">Settings</span>
        </a>
        <button type="button" id="logoutLink" style="width: 100%; display: flex; align-items: center; gap: 12px; padding: 12px; border-radius: 8px; text-decoration: none; color: #ef4444; transition: background 0.2s; background: none; border: none; cursor: pointer; text-align: left;" onmouseover="this.style.backgroundColor='rgba(239, 68, 68, 0.1)'" onmouseout="this.style.backgroundColor='transparent'">
            <span class="material-symbols-outlined" style="color: #ef4444; font-size: 20px;">logout</span>
            <span style="font-weight: 600; font-size: 0.875rem;">Logout</span>
        </button>
    </div>
</div>

<style>
    /* Header Styles */
    .top-header {
        height: 70px;
        background: #FFFFFF;
        border-bottom: 1px solid #EEEEEE;
        display: flex;
        align-items: center;
        padding: 0 1.5rem;
        position: sticky;
        top: 0;
        z-index: 100;
        font-family: 'Poppins', sans-serif;
    }

    .header-icon-btn {
        width: 2.5rem;
        height: 2.5rem;
        border-radius: 0.5rem;
        border: none;
        background: #F7F7F7;
        color: #666666;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease;
    }

    .header-icon-btn:hover {
        background: #EEEEEE;
        color: #5E2A97;
    }

    .header-icon-btn .material-symbols-outlined {
        font-size: 22px;
    }

    .header-avatar {
        width: 2.5rem;
        height: 2.5rem;
        border-radius: 50%;
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        border: 2px solid #5E2A97;
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .header-avatar:hover {
        transform: scale(1.05);
        box-shadow: 0 0 0 4px rgba(94, 42, 151, 0.1);
    }

    /* Active state for panels */
    #notificationPanel.active,
    #helpModal.active,
    #profileDropdown.active {
        display: block !important;
        opacity: 1 !important;
        transform: translateY(0) !important;
    }

    @keyframes slideDown {
        from {
            opacity: 0;
            transform: translateY(-10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }

    @keyframes fadeOut {
        from { opacity: 1; }
        to { opacity: 0; }
    }

    @media (max-width: 768px) {
        .top-header {
            padding: 0 1rem;
        }
    }
</style>

<script>
    // Header JavaScript Functionality
    (function() {
        console.log('Header script loaded and executing...');

        // Notification panel toggle
        function initNotificationPanel() {
            const notificationBtn = document.getElementById('notificationBtn');
            const notificationPanel = document.getElementById('notificationPanel');
            const closeBtn = document.getElementById('closeNotificationPanel');
            const profileDropdown = document.getElementById('profileDropdown');
            const helpModal = document.getElementById('helpModal');

            if (notificationBtn && notificationPanel) {
                console.log('Notification button and panel found, attaching event listener');
                notificationBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    console.log('Notification button clicked');
                    console.log('Current classes on notification panel:', notificationPanel.className);

                    // Close other panels
                    if (helpModal) helpModal.classList.remove('active');
                    if (profileDropdown) profileDropdown.classList.remove('active');

                    // Toggle notification panel
                    notificationPanel.classList.toggle('active');
                    console.log('After toggle - classes on notification panel:', notificationPanel.className);
                });
            } else {
                console.log('Notification button or panel not found!', { notificationBtn, notificationPanel });
            }

            if (closeBtn) {
                closeBtn.addEventListener('click', function() {
                    notificationPanel.classList.remove('active');
                });
            }

            // Close when clicking outside
            document.addEventListener('click', function(e) {
                if (notificationPanel && !notificationPanel.contains(e.target) &&
                    notificationBtn && !notificationBtn.contains(e.target)) {
                    notificationPanel.classList.remove('active');
                }
            });
        }

        // Help modal toggle
        function initHelpModal() {
            const helpBtn = document.getElementById('helpBtn');
            const helpModal = document.getElementById('helpModal');
            const closeBtn = document.getElementById('closeHelpModal');
            const notificationPanel = document.getElementById('notificationPanel');
            const profileDropdown = document.getElementById('profileDropdown');

            if (helpBtn && helpModal) {
                helpBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    console.log('Help button clicked');

                    // Close other panels
                    if (notificationPanel) notificationPanel.classList.remove('active');
                    if (profileDropdown) profileDropdown.classList.remove('active');

                    // Toggle help modal
                    helpModal.classList.toggle('active');
                });
            }

            if (closeBtn) {
                closeBtn.addEventListener('click', function() {
                    helpModal.classList.remove('active');
                });
            }

            // Close when clicking outside
            document.addEventListener('click', function(e) {
                if (helpModal && !helpModal.contains(e.target) &&
                    helpBtn && !helpBtn.contains(e.target)) {
                    helpModal.classList.remove('active');
                }
            });
        }

        // Profile dropdown toggle
        function initProfileDropdown() {
            const avatar = document.getElementById('profileAvatarBtn');
            const profileDropdown = document.getElementById('profileDropdown');
            const notificationPanel = document.getElementById('notificationPanel');
            const helpModal = document.getElementById('helpModal');

            if (avatar && profileDropdown) {
                console.log('Profile avatar and dropdown found, attaching event listener');
                avatar.style.cursor = 'pointer';

                avatar.addEventListener('click', function(e) {
                    e.stopPropagation();
                    console.log('Profile avatar clicked');
                    console.log('Current classes on profile dropdown:', profileDropdown.className);

                    // Close other panels
                    if (notificationPanel) notificationPanel.classList.remove('active');
                    if (helpModal) helpModal.classList.remove('active');

                    // Toggle profile dropdown
                    profileDropdown.classList.toggle('active');
                    console.log('After toggle - classes on profile dropdown:', profileDropdown.className);
                });
            } else {
                console.log('Profile avatar or dropdown not found!', { avatar, profileDropdown });
            }

            // Close when clicking outside
            document.addEventListener('click', function(e) {
                if (profileDropdown && !profileDropdown.contains(e.target) &&
                    avatar && !avatar.contains(e.target)) {
                    profileDropdown.classList.remove('active');
                }
            });

            // Handle logout
            const logoutLink = document.getElementById('logoutLink');
            if (logoutLink) {
                console.log('Logout button found, attaching event listener');
                logoutLink.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('Logout button clicked');

                    // Show confirmation dialog
                    if (confirm('Are you sure you want to logout?')) {
                        console.log('Logout confirmed, redirecting...');

                        // Close dropdown
                        if (profileDropdown) {
                            profileDropdown.classList.remove('active');
                        }

                        // Clear any stored user data
                        sessionStorage.clear();
                        localStorage.removeItem('userToken');

                        // Redirect to login page immediately
                        window.location.href = '../auth/sign-in.html';
                    } else {
                        console.log('Logout cancelled');
                    }
                });
            } else {
                console.log('Logout button not found!');
            }
        }

        // Sidebar toggle functionality
        function initSidebarToggle() {
            const sidebarToggleBtn = document.getElementById('sidebarToggleBtn');
            const sidebar = document.getElementById('juryAppSidebar');

            if (sidebarToggleBtn && sidebar) {
                sidebarToggleBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    console.log('Sidebar toggle clicked');

                    // Toggle collapsed state on desktop
                    if (window.innerWidth >= 768) {
                        sidebar.classList.toggle('collapsed');
                    } else {
                        // Toggle mobile-open state on mobile
                        sidebar.classList.toggle('mobile-open');
                    }
                });
            }

            // Close sidebar on mobile when clicking outside
            document.addEventListener('click', function(e) {
                if (sidebar && window.innerWidth < 768) {
                    if (!e.target.closest('#juryAppSidebar') && !e.target.closest('#sidebarToggleBtn')) {
                        sidebar.classList.remove('mobile-open');
                    }
                }
            });
        }

        // Flag to prevent duplicate initialization
        let initialized = false;

        // Initialize all functionality
        function init() {
            if (initialized) {
                console.log('Header already initialized, skipping...');
                return;
            }

            console.log('Initializing header functionality...');
            initNotificationPanel();
            initHelpModal();
            initProfileDropdown();
            initSidebarToggle();
            initialized = true;
            console.log('Header initialization complete!');
        }

        // Run init when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            // DOM already loaded, wait a bit for header to be injected
            setTimeout(init, 100);
        }

        // Also run init when the script loads (for when injected via innerHTML)
        setTimeout(init, 100);
    })();
</script>
